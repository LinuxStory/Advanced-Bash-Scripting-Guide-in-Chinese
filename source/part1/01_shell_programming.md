# 第一章 为什么使用shell编程
> 没有任何一种程序设计语言是完美的，甚至没有一个最好的语言。只有在特定环境下适合与否的语言。
>
> —— Herbert Mayer

无论你是否打算真正编写shell脚本，只要你想要在一定程度上熟悉系统管理，了解并掌握shell脚本的相关知识都是非常有必要的。例如Linux系统在启动的时候会执行`/etc/rc.d`目录下的shell脚本来恢复系统配置和准备服务。而详细了解这些启动脚本对于分析系统的行为是至关重要的，并且你很有可能会去修改他们。

编写脚本并不是那么困难，因为它是由许多小的部分所组成，而其中只有数量相当少的与shell特性的操作和选项[^1]需要去学习。Shell语法非常简单朴素，很像是在命令行当中调用和连接工具，而且你只需要遵守很少一部分的规则就可以了。大部分简短的脚本通常在第一次就可以正常工作，而且即使调试一个长一些的脚本也是非常直观的。

> 在个人计算机发展的早期，Basic语言让计算机专业人士能够在早期的微机上编写程序。而几十年后，Bash脚本语言可以让所有仅仅对Linux或者UNIX系统有初步了解的用户在现代计算机上做同样的事。
> 
> 我们现在能够让单板机很小却拥有强大的性能，比如[树莓派](http://www.raspberrypi.org/)。而Bash脚本提供了一种发掘这些有趣的设备的能力的方法。

在建立一个复杂应用原型（prototype）的时候，使用shell脚本是一种虽然有缺陷但非常快速的方法。在开发的初级阶段，即使使用脚本实现了函数的部分功能往往都是非常有用的。因此在使用C/C++，Java，Perl或者Python等语言编写最终代码前，可以使用shell脚本测试和修补应用的架构，发现重大的缺陷。

Shell脚本与经典的UINX哲学相类似，就是将复杂的工程分成简单的子任务，并将组件与工具连接在一起。许多人认为比起新一代的那些功能强大、高度集成的语言来说，shell脚本至少是一种在美学上更加令人愉悦的解决问题的方法。就像任何人可以使用Perl做任何事情，但是你必须强迫自己改变思维方式以适应Perl。

Herbert Mayer曾说：“有用的语言需要有数组、指针以及构建数据结构的通用机制”。根据这些标准，shell脚本在某些方面离“有用”还有差距，甚至是“无用”的。

### 什么时候不应该使用shell脚本
- 资源密集型的任务，尤其是对速度有要求时（如排序、散列、递归[^2]等）
- 需要做大量的数学操作时，例如浮点数运算，高精度运算或者复数运算时（使用C++或者FORTRAN代替）
- 有跨平台需求（使用C或者Java代替）
- 必须使用结构化编程的复杂应用（如变量类型检查、函数原型等）
- 影响系统全局的关键性任务
- 对安全性有高要求，需要保证系统的完整性以及阻止入侵、破解、恶意破坏时
- 项目包含有连锁依赖关系的组件
- 需要做大量的文件操作时（Bash只能访问连续的文件，并且是以一种非常笨拙且低效的逐行访问的方式进行）
- 需要使用多维数组时
- 需要使用如链表、数等数据结构时
- 需要产生或操作图像和图形用户接口时（GUI）
- 需要直接访问系统硬件或外部设备时
- 需要使用端口或套接字输入输出端口（Socket I/O）时
- 需要使用库或旧程序的接口时
- 私有的或闭源的项目（Shell脚本直接将源代码公开，所有人都可以看到）

如果你的应用满足上边的任意一条，你可以考虑使用更加强大的脚本语言，如Perl，Tcl，Python，Ruby等，或者可考虑使用编译型语言，如C，C++或者Java等。但即使这样，在开发阶段使用shell脚本建立应用的原型也是非常有用的。

我们接下来将使用Bash。Bash是"Bourne-Again shell"的首字母缩略词[^3]，它的来源是Stephen Bourne开发的Bourne shell（sh）的一个双关语（Bourne again / born again）。Bash已经成为了大部分UNIX衍生版中shell脚本事实上的标准。本书所涉及的大部分原理在其他shell脚本中也是适用的，例如Korn Shell，Bash从它当中继承了一部分的特性[^4]；又如C Shell及其变体（需要注意的是，1993年10月Tom Christiansen在[Usenet帖子](http://www.faqs.org/faqs/unix-faq/shell/csh-whynot/)中指出因C Shell内部固有的问题，并不推荐使用它进行编程）

接下来将会是一些shell编程的指导。这些指导很大程度上依赖于例子来阐述shell的特点。本书所有的例子都能够正常工作，并在尽可能的范围内进行过测试，其中的一部分已经运用在现实生活中。读者们可以使用这些在存档中的例子（文件名为`scriptname.sh`或`scriptname.bash`）[^5]，给予他们执行的权限（`chmod u+rx scriptname`），然后运行他们看看发生了什么。如果[存档](http://bash.deta.in/abs-guide-latest.tar.bz2)不可用，读者朋友可以从本书的HTML或者PDF版本中复制粘贴出来。读者需要注意在部分例子中使用了一些还没有被解释的特性，这需要读者暂时的跳过这些部分。

除非特别说明，所有的例子都是由[本书作者](mailto:thegrendel.abs@gmail.com)撰写的。

> His countenance was bold and bashed not.
>
> —— Edmund Spenser


[^1]: 这些操作和选项被称为内置（builtin），是shell的内部特征。
[^2]: 尽管递归是可以在shell脚本中实现的，但是它的效率很低并且实现起来很复杂、不具有美感。
[^3]: 首字母缩略词是由每一个单词的首字母拼接而成的易读的代替短语。这并不是一种良好的行为，通常会引起一些麻烦。
[^4]: ksh88中的许多特性，甚至一些ksh93的特性都被合并到Bash中了。
[^5]: 按照惯例，用户编写的Bourne shell脚本应该在文件名后加上`.sh`的扩展名。而那些系统脚本，比如在`/etc/rc.d`中的脚本通常不遵循这种规范。